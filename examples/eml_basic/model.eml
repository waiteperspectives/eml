# eml: 0.0.1

form CustomerForm {
    name: "Bob"
    age: "21"
    email: "bob@example.com"
}

command AddCustomer {
    name: "Bob"
    age: "21"
    email: "bob@example.com"
}

event CustomerAdded {
    name: "Bob"
    age: "21"
    email: "bob@example.com"
}


view AccountsToAdd {
  | CustomerId | state  |
  |------------|--------|
  | 123        | done   |
  | 456        | todo   |
  | 789        | todo   |
}

flow { CustomerForm => AddCustomer => CustomerAdded }

job ProcessAccountsToAdd {}

command AddAccount {
    CustomerId: "123"
    Name: "Bob"
}

event AccountAdded {
    CustomerId: "123"
    Name: "Bob"
}

flow { CustomerAdded => AccountsToAdd }
flow { AccountsToAdd => ProcessAccountsToAdd => AddAccount => AccountAdded }

view UsersToAdd {
  | CustomerId | state  |
  |------------|--------|
  | 123        | done   |
  | 456        | todo   |
  | 789        | todo   |
}

job ProcessUsersToAdd {}

command AddUser {
    Name: "Bob"
    Login: "Bob"
}

event UserAdded {
    Name: "Bob"
    Login: "Bob"
}

flow { CustomerAdded => UsersToAdd }
flow { UsersToAdd => ProcessUsersToAdd => AddUser => UserAdded }

