# eml: 0.0.1

form CustomerForm {
    name: Bob
    age: 21
    email: bob@example.com
}

command AddCustomer {use CustomerForm}

event CustomerAdded { use CustomerForm }

flow { CustomerForm => AddCustomer => CustomerAdded }

view AccountsToAdd {
  | CustomerId | state  |
  |------------|--------|
  | 123        | done   |
  | 456        | todo   |
  | 789        | todo   |
}
flow { CustomerAdded => AccountsToAdd }

view DemoTodo { use AccountsToAdd }
flow { CustomerAdded => DemoTodo }


job ProcessAccountsToAdd {}

command AddAccount {
    CustomerId: 123
    Name: Bob
}

event AccountAdded {
    CustomerId: 123
    Name: Bob
}

flow { AccountsToAdd => ProcessAccountsToAdd => AddAccount => AccountAdded }

view UsersToAdd {
  | CustomerId | state  |
  |------------|--------|
  | 123        | done   |
  | 456        | todo   |
  | 789        | todo   |
}

job ProcessUsersToAdd {}

command AddUser {
    Name: Bob
    Login: Bob
}

event UserAdded {
    Name: Bob
    Login: Bob
}

flow { CustomerAdded => UsersToAdd }
flow { UsersToAdd => ProcessUsersToAdd => AddUser => UserAdded }

